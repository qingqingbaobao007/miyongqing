# Redis与MongoDB

## 一、NoSQL概述

如今，大多数的计算器系统（包括服务器、PC、移动设备等）都会产生庞大的数据量。其实，早在2012年的时候，全世界每天产生的数据量就达到了2.5EB（艾字节， ）。这些数据有很
⼤⼀部分是由关系型数据库来存储和管理的。实践证明，关系型数据库是实现数据持久化最为᯿要的⽅式，它也是⼤多数应⽤在选择持久化⽅案时的⾸选技术。

NoSQL 是⼀项全新的数据库⾰命性运动，虽然它的历史可以追溯到1998年，但是NoSQL真正深⼊⼈⼼
并得到⼴泛的应⽤是在进⼊⼤数据时候以后，业界普遍认为NoSQL是更适合⼤数据存储的技术⽅案，这
才使得NoSQL的发展达到了前所未有的⾼度。2012年《纽约时报》的⼀篇专栏中写到，⼤数据时代已
经降临，在商业、经济及其他领域中，决策将不再基于经验和直觉⽽是基于数据和分析⽽作出。事实
上，在天⽂学、⽓象学、基因组学、⽣物学、社会学、互联⽹搜索引擎、⾦融、医疗、社交⽹络、电⼦
商务等诸多领域，由于数据过于密集和庞⼤，在数据的分析和处理上也遇到了前所未有的限制和阻碍，
这⼀切都使得对⼤数据处理技术的研究被提升到了新的⾼度，也使得各种NoSQL的技术⽅案进⼊到了公
众的视野。

### NoSQL数据库按照其存储类型可以⼤致分为以下⼏类：

| 类型       | 部分代表                                | 特点                                                         |
| ---------- | --------------------------------------- | ------------------------------------------------------------ |
| 列族数据库 | HBase<br />Cassandra<br />Hypertable    | 顾名思义是按列存储数据的。最⼤的特点是⽅便存储结构化和半结构化<br/>数据，⽅便做数据压缩，对针对某⼀列或者某⼏列的查询有⾮常⼤的I/O<br/>优势，适合于批量数据处理和即时查询。 |
| 文档数据库 | MongoDB<br />CouchDB<br />ElasticSearch | ⽂档数据库⼀般⽤类JSON格式存储数据，存储的内容是⽂档型的。这样<br/>也就有机会对某些字段建⽴索引，实现关系数据库的某些功能，但不提<br/>供对参照完整性和分布事务的⽀持。 |
| KV数据库   | DynamoDB<br />Redis<br />LeveIDB        | 可以通过key快速查询到其value，有基于内存和基于磁盘两种实现⽅<br/>案。 |
| 图数据库   | Neo4J<br />FlockDB<br />JanusGraph      | 使⽤图结构进⾏语义查询的数据库，它使⽤节点、边和属性来表示和存<br/>储数据。图数据库从设计上，就可以简单快速的检索难以在关系系统中<br/>建模的复杂层次结构。 |
| 对象数据库 | db4o<br />Versant                       | 通过类似面向对象语言的语法操作数据库，通过对象的方式存取数据 |

## 二、Redis入门

Redis 是⼀种基于键值对的NoSQL数据库，它提供了对多种数据类型（字符串、哈希、列表、集合、有序集合、位图等）的⽀持，能够满⾜很多应⽤场景的需求。Redis将数据放在内存中，因此读写性能是⾮常惊⼈的。与此同时，Redis也提供了持久化机制，能够将内存中的数据保存到硬盘上，在发⽣意外状况时数据也不会丢掉。此外，Redis还⽀持键过期、地理信息运算、发布订阅、事务、管道、Lua脚本扩展等功能，总⽽⾔之，Redis的功能和性能都⾮常强⼤，如果项⽬中要实现⾼速缓存和消息队列这样的服务，直接交给Redis就可以了。⽬前，国内外很多著名的企业和商业项⽬都使⽤了Redis，包括：Twitter、Github、StackOverflow、新浪微博、百度、优酷⼟⾖、美团、⼩⽶、唯品会等。

### 1.Redis简介

2008年，⼀个名为Salvatore Sanfilippo的程序员为他开发的LLOOGG项⽬定制了专属的数据库（因为之前他⽆论怎样优化MySQL，系统性能已经⽆法再提升了），这项⼯作的成果就是Redis的初始版本。后来他将Redis的代码放到了全球最⼤的代码托管平Github，从那以后，Redis引发了⼤量开发者的好评和关注，继⽽有数百⼈参与了Redis的开发和维护，这使得Redis的功能越来越强⼤和性能越来越好。Redis是 remote dictionary server 的缩写，它是⼀个⽤ ANSI C 编写的⾼性能的key-value存储系统，与其他的key-value存储系统相⽐，Redis有以下⼀些特点（也是优点）：

+ Redis的读写性极高，并且有丰富的特性（发布/订阅、事务、通知等）。
+ Redis支持数据的持久化（RDB和AOF两种方式，可以将内存中的数据保存到磁盘中，重启的时候可以挨次加载进行使用。
+ Redis⽀持多种数据类型，包括：string、hash、list、set，zset、bitmap、hyperloglog等。
+ Redis⽀持主从复制（实现读写分析）以及哨兵模式（监控master是否宕机并⾃动调整配置）。
+ Redis⽀持分布式集群，可以很容易的通过⽔平扩展来提升系统的整体性能。
+ Redis基于TCP提供的可靠传输服务进⾏通信，很多编程语⾔都提供了Redis客户端⽀持。

### 2.Redis的应用场景

1.高速缓存 - 将不常变化但又经常被访问的热点数据放到Redis数据库中，可以大大降低关系型数据库的压力从而提升系统的响应性能。

2.排行榜 - 很多网站都有排行榜功能，利用Redis中的列表和有序集合可以⾮常⽅便的构造各种排⾏
榜系统。

3.商品秒杀/投票点赞 - Redis提供了对计数操作的⽀持，⽹站上常⻅的秒杀、点赞等功能都可以利⽤Redis的计数器通过+1或-1的操作来实现，从⽽避免了使⽤关系型数据的 update 操作。

4.分布式锁 - 利⽤Redis可以跨多台服务器实现分布式锁（类似于线程锁，但是能够被多台机器上的多个线程或进程共享）的功能，⽤于实现⼀个阻塞式操作。

5.消息队列 - 消息队列和⾼速缓存⼀样，是⼀个⼤型⽹站不可缺少的基础服务，可以实现业务解耦和⾮实时业务削峰等特性，这些我们都会在后⾯的项⽬中为⼤家展示。

### 3.Redis的安装和配置

可以使⽤ Linux 系统的包管理⼯具 apt 来安装 Redis：`apt install redis`

也可以通过Redis的官方网站下载Redis的源代码，解压缩归档之后通过make工具对源代码进行构建并安装

```sql
wget http://download.redis.io/releases/redis-5.0.5.tar.gz
tar -xvf redis-5.0.5.tar
cd redis-5.0.5
make && make install
```

### 4.Redis的配置

在Redis源代码目录下有一个名为redis.com的配置文件，我们可以先查看一下该文件：`vim redis.conf`

1.配置将Redis服务绑定到指定的IP地址和端口。

```sql
bind 127.0.0.1
port 6379
```

2.设置后台运行（以守护进程方式运行）

```sql
daemonize yes
```

3.设置日志级别，可选填（debug：调试，verbose：详细，notice：通知，warning：警告）

```sql
loglevel warning
```

4.配置数据库的数量, 默认为 16 个

```sql
databases 16
```

5.配置数据写⼊规则

```sql
save 900 1 # 900 秒 (15 分钟) 内修改过 1 个 key, , 写⼊⼀次数据库
save 300 10 # 300 秒 (5 分钟) 内修改过 10 个 key, 写⼊⼀次数据库
save 60 10000 # 60 秒 (1 分钟) 内修改过 10000 个 key, 写⼊⼀次数据库
```

6.配置Redis的持久化机制 - RDB。

```sql
rdbcompression yes # 压缩 RDB ⽂件
rdbchecksum yes # 对 RDB ⽂件进⾏校验
dbfilename dump.rdb # RDB 数据库⽂件的⽂件名
dir ./ # RDB ⽂件保存的⽬录
```

7.配置Redis的持久化机制 - AOF。

```sql
appendonly no
appendfilename "appendonly.aof"
```

